(()=>{var mr=Object.create;var Et=Object.defineProperty;var dr=Object.getOwnPropertyDescriptor;var gr=Object.getOwnPropertyNames,me=Object.getOwnPropertySymbols,yr=Object.getPrototypeOf,de=Object.prototype.hasOwnProperty,wr=Object.prototype.propertyIsEnumerable;var ge=(n,r,a)=>r in n?Et(n,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[r]=a,Rt=(n,r)=>{for(var a in r||(r={}))de.call(r,a)&&ge(n,a,r[a]);if(me)for(var a of me(r))wr.call(r,a)&&ge(n,a,r[a]);return n};var br=n=>Et(n,"__esModule",{value:!0});var q=(n,r)=>()=>(r||n((r={exports:{}}).exports,r),r.exports);var vr=(n,r,a)=>{if(r&&typeof r=="object"||typeof r=="function")for(let o of gr(r))!de.call(n,o)&&o!=="default"&&Et(n,o,{get:()=>r[o],enumerable:!(a=dr(r,o))||a.enumerable});return n},tt=n=>vr(br(Et(n!=null?mr(yr(n)):{},"default",n&&n.__esModule&&"default"in n?{get:()=>n.default,enumerable:!0}:{value:n,enumerable:!0})),n);var et=q((Xr,ye)=>{"use strict";function ct(n,r,a,o,p,l){return{tag:n,key:r,attrs:a,children:o,text:p,dom:l,domSize:void 0,state:void 0,events:void 0,instance:void 0}}ct.normalize=function(n){return Array.isArray(n)?ct("[",void 0,void 0,ct.normalizeChildren(n),void 0,void 0):n==null||typeof n=="boolean"?null:typeof n=="object"?n:ct("#",void 0,void 0,String(n),void 0,void 0)};ct.normalizeChildren=function(n){var r=[];if(n.length){for(var a=n[0]!=null&&n[0].key!=null,o=1;o<n.length;o++)if((n[o]!=null&&n[o].key!=null)!==a)throw new TypeError("Vnodes must either always have keys or never have keys!");for(var o=0;o<n.length;o++)r[o]=ct.normalize(n[o])}return r};ye.exports=ct});var Jt=q((Qr,we)=>{"use strict";var xr=et();we.exports=function(){var n=arguments[this],r=this+1,a;if(n==null?n={}:(typeof n!="object"||n.tag!=null||Array.isArray(n))&&(n={},r=this),arguments.length===r+1)a=arguments[r],Array.isArray(a)||(a=[a]);else for(a=[];r<arguments.length;)a.push(arguments[r++]);return xr("",n.key,n,a)}});var Yt=q((Jr,Me)=>{"use strict";var be=et(),Mr=Jt(),Cr=/(?:(^|#|\.)([^#\.\[\]]+))|(\[(.+?)(?:\s*=\s*("|'|)((?:\\["'\]]|.)*?)\5)?\])/g,ve={},ft={}.hasOwnProperty;function xe(n){for(var r in n)if(ft.call(n,r))return!1;return!0}function Er(n){for(var r,a="div",o=[],p={};r=Cr.exec(n);){var l=r[1],h=r[2];if(l===""&&h!=="")a=h;else if(l==="#")p.id=h;else if(l===".")o.push(h);else if(r[3][0]==="["){var u=r[6];u&&(u=u.replace(/\\(["'])/g,"$1").replace(/\\\\/g,"\\")),r[4]==="class"?o.push(u):p[r[4]]=u===""?u:u||!0}}return o.length>0&&(p.className=o.join(" ")),ve[n]={tag:a,attrs:p}}function Rr(n,r){var a=r.attrs,o=be.normalizeChildren(r.children),p=ft.call(a,"class"),l=p?a.class:a.className;if(r.tag=n.tag,r.attrs=null,r.children=void 0,!xe(n.attrs)&&!xe(a)){var h={};for(var u in a)ft.call(a,u)&&(h[u]=a[u]);a=h}for(var u in n.attrs)ft.call(n.attrs,u)&&u!=="className"&&!ft.call(a,u)&&(a[u]=n.attrs[u]);(l!=null||n.attrs.className!=null)&&(a.className=l!=null?n.attrs.className!=null?String(n.attrs.className)+" "+String(l):l:n.attrs.className!=null?n.attrs.className:null),p&&(a.class=null);for(var u in a)if(ft.call(a,u)&&u!=="key"){r.attrs=a;break}return Array.isArray(o)&&o.length===1&&o[0]!=null&&o[0].tag==="#"?r.text=o[0].children:r.children=o,r}function Ar(n){if(n==null||typeof n!="string"&&typeof n!="function"&&typeof n.view!="function")throw Error("The selector must be either a string or a component.");var r=Mr.apply(1,arguments);return typeof n=="string"&&(r.children=be.normalizeChildren(r.children),n!=="[")?Rr(ve[n]||Er(n),r):(r.tag=n,r)}Me.exports=Ar});var Ee=q((Yr,Ce)=>{"use strict";var Tr=et();Ce.exports=function(n){return n==null&&(n=""),Tr("<",void 0,void 0,n,void 0,void 0)}});var Ae=q((Zr,Re)=>{"use strict";var Pr=et(),Or=Jt();Re.exports=function(){var n=Or.apply(0,arguments);return n.tag="[",n.children=Pr.normalizeChildren(n.children),n}});var Pe=q((ti,Te)=>{"use strict";var Zt=Yt();Zt.trust=Ee();Zt.fragment=Ae();Te.exports=Zt});var te=q((ei,Oe)=>{"use strict";var I=function(n){if(!(this instanceof I))throw new Error("Promise must be called with `new`");if(typeof n!="function")throw new TypeError("executor must be a function");var r=this,a=[],o=[],p=f(a,!0),l=f(o,!1),h=r._instance={resolvers:a,rejectors:o},u=typeof setImmediate=="function"?setImmediate:setTimeout;function f(g,w){return function x(y){var M;try{if(w&&y!=null&&(typeof y=="object"||typeof y=="function")&&typeof(M=y.then)=="function"){if(y===r)throw new TypeError("Promise can't be resolved w/ itself");m(M.bind(y))}else u(function(){!w&&g.length===0&&console.error("Possible unhandled promise rejection:",y);for(var b=0;b<g.length;b++)g[b](y);a.length=0,o.length=0,h.state=w,h.retry=function(){x(y)}})}catch(b){l(b)}}}function m(g){var w=0;function x(M){return function(b){w++>0||M(b)}}var y=x(l);try{g(x(p),y)}catch(M){y(M)}}m(n)};I.prototype.then=function(n,r){var a=this,o=a._instance;function p(f,m,g,w){m.push(function(x){if(typeof f!="function")g(x);else try{l(f(x))}catch(y){h&&h(y)}}),typeof o.retry=="function"&&w===o.state&&o.retry()}var l,h,u=new I(function(f,m){l=f,h=m});return p(n,o.resolvers,l,!0),p(r,o.rejectors,h,!1),u};I.prototype.catch=function(n){return this.then(null,n)};I.prototype.finally=function(n){return this.then(function(r){return I.resolve(n()).then(function(){return r})},function(r){return I.resolve(n()).then(function(){return I.reject(r)})})};I.resolve=function(n){return n instanceof I?n:new I(function(r){r(n)})};I.reject=function(n){return new I(function(r,a){a(n)})};I.all=function(n){return new I(function(r,a){var o=n.length,p=0,l=[];if(n.length===0)r([]);else for(var h=0;h<n.length;h++)(function(u){function f(m){p++,l[u]=m,p===o&&r(l)}n[u]!=null&&(typeof n[u]=="object"||typeof n[u]=="function")&&typeof n[u].then=="function"?n[u].then(f,a):f(n[u])})(h)})};I.race=function(n){return new I(function(r,a){for(var o=0;o<n.length;o++)n[o].then(r,a)})};Oe.exports=I});var ee=q((ri,At)=>{"use strict";var wt=te();typeof window!="undefined"?(typeof window.Promise=="undefined"?window.Promise=wt:window.Promise.prototype.finally||(window.Promise.prototype.finally=wt.prototype.finally),At.exports=window.Promise):typeof global!="undefined"?(typeof global.Promise=="undefined"?global.Promise=wt:global.Promise.prototype.finally||(global.Promise.prototype.finally=wt.prototype.finally),At.exports=global.Promise):At.exports=wt});var De=q((ii,qe)=>{"use strict";var ut=et();qe.exports=function(n){var r=n&&n.document,a,o={svg:"http://www.w3.org/2000/svg",math:"http://www.w3.org/1998/Math/MathML"};function p(e){return e.attrs&&e.attrs.xmlns||o[e.tag]}function l(e,t){if(e.state!==t)throw new Error("`vnode.state` must not be modified")}function h(e){var t=e.state;try{return this.apply(t,arguments)}finally{l(e,t)}}function u(){try{return r.activeElement}catch(e){return null}}function f(e,t,i,s,c,d,C){for(var E=i;E<s;E++){var v=t[E];v!=null&&m(e,v,c,C,d)}}function m(e,t,i,s,c){var d=t.tag;if(typeof d=="string")switch(t.state={},t.attrs!=null&&Ht(t.attrs,t,i),d){case"#":g(e,t,c);break;case"<":x(e,t,s,c);break;case"[":y(e,t,i,s,c);break;default:M(e,t,i,s,c)}else R(e,t,i,s,c)}function g(e,t,i){t.dom=r.createTextNode(t.children),st(e,t.dom,i)}var w={caption:"table",thead:"table",tbody:"table",tfoot:"table",tr:"tbody",th:"tr",td:"tr",colgroup:"table",col:"colgroup"};function x(e,t,i,s){var c=t.children.match(/^\s*?<(\w+)/im)||[],d=r.createElement(w[c[1]]||"div");i==="http://www.w3.org/2000/svg"?(d.innerHTML='<svg xmlns="http://www.w3.org/2000/svg">'+t.children+"</svg>",d=d.firstChild):d.innerHTML=t.children,t.dom=d.firstChild,t.domSize=d.childNodes.length,t.instance=[];for(var C=r.createDocumentFragment(),E;E=d.firstChild;)t.instance.push(E),C.appendChild(E);st(e,C,s)}function y(e,t,i,s,c){var d=r.createDocumentFragment();if(t.children!=null){var C=t.children;f(d,C,0,C.length,i,null,s)}t.dom=d.firstChild,t.domSize=d.childNodes.length,st(e,d,c)}function M(e,t,i,s,c){var d=t.tag,C=t.attrs,E=C&&C.is;s=p(t)||s;var v=s?E?r.createElementNS(s,d,{is:E}):r.createElementNS(s,d):E?r.createElement(d,{is:E}):r.createElement(d);if(t.dom=v,C!=null&&ar(t,C,s),st(e,v,c),!ot(t)&&(t.text!=null&&(t.text!==""?v.textContent=t.text:t.children=[ut("#",void 0,void 0,t.text,void 0,void 0)]),t.children!=null)){var T=t.children;f(v,T,0,T.length,i,null,s),t.tag==="select"&&C!=null&&or(t,C)}}function b(e,t){var i;if(typeof e.tag.view=="function"){if(e.state=Object.create(e.tag),i=e.state.view,i.$$reentrantLock$$!=null)return;i.$$reentrantLock$$=!0}else{if(e.state=void 0,i=e.tag,i.$$reentrantLock$$!=null)return;i.$$reentrantLock$$=!0,e.state=e.tag.prototype!=null&&typeof e.tag.prototype.view=="function"?new e.tag(e):e.tag(e)}if(Ht(e.state,e,t),e.attrs!=null&&Ht(e.attrs,e,t),e.instance=ut.normalize(h.call(e.state.view,e)),e.instance===e)throw Error("A view cannot return the vnode it received as argument");i.$$reentrantLock$$=null}function R(e,t,i,s,c){b(t,i),t.instance!=null?(m(e,t.instance,i,s,c),t.dom=t.instance.dom,t.domSize=t.dom!=null?t.instance.domSize:0):t.domSize=0}function A(e,t,i,s,c,d){if(!(t===i||t==null&&i==null))if(t==null||t.length===0)f(e,i,0,i.length,s,c,d);else if(i==null||i.length===0)J(e,t,0,t.length);else{var C=t[0]!=null&&t[0].key!=null,E=i[0]!=null&&i[0].key!=null,v=0,T=0;if(!C)for(;T<t.length&&t[T]==null;)T++;if(!E)for(;v<i.length&&i[v]==null;)v++;if(E===null&&C==null)return;if(C!==E)J(e,t,T,t.length),f(e,i,v,i.length,s,c,d);else if(E){for(var _=t.length-1,z=i.length-1,Ct,H,L,k,O,Gt;_>=T&&z>=v&&(k=t[_],O=i[z],k.key===O.key);)k!==O&&S(e,k,O,s,c,d),O.dom!=null&&(c=O.dom),_--,z--;for(;_>=T&&z>=v&&(H=t[T],L=i[v],H.key===L.key);)T++,v++,H!==L&&S(e,H,L,s,Q(t,T,c),d);for(;_>=T&&z>=v&&!(v===z||H.key!==O.key||k.key!==L.key);)Gt=Q(t,T,c),K(e,k,Gt),k!==L&&S(e,k,L,s,Gt,d),++v<=--z&&K(e,H,c),H!==O&&S(e,H,O,s,c,d),O.dom!=null&&(c=O.dom),T++,_--,k=t[_],O=i[z],H=t[T],L=i[v];for(;_>=T&&z>=v&&k.key===O.key;)k!==O&&S(e,k,O,s,c,d),O.dom!=null&&(c=O.dom),_--,z--,k=t[_],O=i[z];if(v>z)J(e,t,T,_+1);else if(T>_)f(e,i,v,z+1,s,c,d);else{var pr=c,pe=z-v+1,yt=new Array(pe),Kt=0,D=0,Wt=2147483647,Xt=0,Ct,Qt;for(D=0;D<pe;D++)yt[D]=-1;for(D=z;D>=v;D--){Ct==null&&(Ct=Y(t,T,_+1)),O=i[D];var lt=Ct[O.key];lt!=null&&(Wt=lt<Wt?lt:-1,yt[D-v]=lt,k=t[lt],t[lt]=null,k!==O&&S(e,k,O,s,c,d),O.dom!=null&&(c=O.dom),Xt++)}if(c=pr,Xt!==_-T+1&&J(e,t,T,_+1),Xt===0)f(e,i,v,z+1,s,c,d);else if(Wt===-1)for(Qt=at(yt),Kt=Qt.length-1,D=z;D>=v;D--)L=i[D],yt[D-v]===-1?m(e,L,s,d,c):Qt[Kt]===D-v?Kt--:K(e,L,c),L.dom!=null&&(c=i[D].dom);else for(D=z;D>=v;D--)L=i[D],yt[D-v]===-1&&m(e,L,s,d,c),L.dom!=null&&(c=i[D].dom)}}else{var Ut=t.length<i.length?t.length:i.length;for(v=v<T?v:T;v<Ut;v++)H=t[v],L=i[v],!(H===L||H==null&&L==null)&&(H==null?m(e,L,s,d,Q(t,v+1,c)):L==null?xt(e,H):S(e,H,L,s,Q(t,v+1,c),d));t.length>Ut&&J(e,t,v,t.length),i.length>Ut&&f(e,i,v,i.length,s,c,d)}}}function S(e,t,i,s,c,d){var C=t.tag,E=i.tag;if(C===E){if(i.state=t.state,i.events=t.events,hr(i,t))return;if(typeof C=="string")switch(i.attrs!=null&&Bt(i.attrs,i,s),C){case"#":it(t,i);break;case"<":nt(e,t,i,d,c);break;case"[":N(e,t,i,s,c,d);break;default:P(t,i,s,d)}else $(e,t,i,s,c,d)}else xt(e,t),m(e,i,s,d,c)}function it(e,t){e.children.toString()!==t.children.toString()&&(e.dom.nodeValue=t.children),t.dom=e.dom}function nt(e,t,i,s,c){t.children!==i.children?(le(e,t),x(e,i,s,c)):(i.dom=t.dom,i.domSize=t.domSize,i.instance=t.instance)}function N(e,t,i,s,c,d){A(e,t.children,i.children,s,c,d);var C=0,E=i.children;if(i.dom=null,E!=null){for(var v=0;v<E.length;v++){var T=E[v];T!=null&&T.dom!=null&&(i.dom==null&&(i.dom=T.dom),C+=T.domSize||1)}C!==1&&(i.domSize=C)}}function P(e,t,i,s){var c=t.dom=e.dom;s=p(t)||s,t.tag==="textarea"&&(t.attrs==null&&(t.attrs={}),t.text!=null&&(t.attrs.value=t.text,t.text=void 0)),cr(t,e.attrs,t.attrs,s),ot(t)||(e.text!=null&&t.text!=null&&t.text!==""?e.text.toString()!==t.text.toString()&&(e.dom.firstChild.nodeValue=t.text):(e.text!=null&&(e.children=[ut("#",void 0,void 0,e.text,void 0,e.dom.firstChild)]),t.text!=null&&(t.children=[ut("#",void 0,void 0,t.text,void 0,void 0)]),A(c,e.children,t.children,i,null,s)))}function $(e,t,i,s,c,d){if(i.instance=ut.normalize(h.call(i.state.view,i)),i.instance===i)throw Error("A view cannot return the vnode it received as argument");Bt(i.state,i,s),i.attrs!=null&&Bt(i.attrs,i,s),i.instance!=null?(t.instance==null?m(e,i.instance,s,d,c):S(e,t.instance,i.instance,s,c,d),i.dom=i.instance.dom,i.domSize=i.instance.domSize):t.instance!=null?(xt(e,t.instance),i.dom=void 0,i.domSize=0):(i.dom=t.dom,i.domSize=t.domSize)}function Y(e,t,i){for(var s=Object.create(null);t<i;t++){var c=e[t];if(c!=null){var d=c.key;d!=null&&(s[d]=t)}}return s}var U=[];function at(e){for(var t=[0],i=0,s=0,c=0,d=U.length=e.length,c=0;c<d;c++)U[c]=e[c];for(var c=0;c<d;++c)if(e[c]!==-1){var C=t[t.length-1];if(e[C]<e[c]){U[c]=C,t.push(c);continue}for(i=0,s=t.length-1;i<s;){var E=(i>>>1)+(s>>>1)+(i&s&1);e[t[E]]<e[c]?i=E+1:s=E}e[c]<e[t[i]]&&(i>0&&(U[c]=t[i-1]),t[i]=c)}for(i=t.length,s=t[i-1];i-- >0;)t[i]=s,s=U[s];return U.length=0,t}function Q(e,t,i){for(;t<e.length;t++)if(e[t]!=null&&e[t].dom!=null)return e[t].dom;return i}function K(e,t,i){var s=r.createDocumentFragment();vt(e,s,t),st(e,s,i)}function vt(e,t,i){for(;i.dom!=null&&i.dom.parentNode===e;){if(typeof i.tag!="string"){if(i=i.instance,i!=null)continue}else if(i.tag==="<")for(var s=0;s<i.instance.length;s++)t.appendChild(i.instance[s]);else if(i.tag!=="[")t.appendChild(i.dom);else if(i.children.length===1){if(i=i.children[0],i!=null)continue}else for(var s=0;s<i.children.length;s++){var c=i.children[s];c!=null&&vt(e,t,c)}break}}function st(e,t,i){i!=null?e.insertBefore(t,i):e.appendChild(t)}function ot(e){if(e.attrs==null||e.attrs.contenteditable==null&&e.attrs.contentEditable==null)return!1;var t=e.children;if(t!=null&&t.length===1&&t[0].tag==="<"){var i=t[0].children;e.dom.innerHTML!==i&&(e.dom.innerHTML=i)}else if(e.text!=null||t!=null&&t.length!==0)throw new Error("Child node of a contenteditable must be trusted");return!0}function J(e,t,i,s){for(var c=i;c<s;c++){var d=t[c];d!=null&&xt(e,d)}}function xt(e,t){var i=0,s=t.state,c,d;if(typeof t.tag!="string"&&typeof t.state.onbeforeremove=="function"){var C=h.call(t.state.onbeforeremove,t);C!=null&&typeof C.then=="function"&&(i=1,c=C)}if(t.attrs&&typeof t.attrs.onbeforeremove=="function"){var C=h.call(t.attrs.onbeforeremove,t);C!=null&&typeof C.then=="function"&&(i|=2,d=C)}if(l(t,s),!i)Mt(t),$t(e,t);else{if(c!=null){var E=function(){i&1&&(i&=2,i||v())};c.then(E,E)}if(d!=null){var E=function(){i&2&&(i&=1,i||v())};d.then(E,E)}}function v(){l(t,s),Mt(t),$t(e,t)}}function le(e,t){for(var i=0;i<t.instance.length;i++)e.removeChild(t.instance[i])}function $t(e,t){for(;t.dom!=null&&t.dom.parentNode===e;){if(typeof t.tag!="string"){if(t=t.instance,t!=null)continue}else if(t.tag==="<")le(e,t);else{if(t.tag!=="["&&(e.removeChild(t.dom),!Array.isArray(t.children)))break;if(t.children.length===1){if(t=t.children[0],t!=null)continue}else for(var i=0;i<t.children.length;i++){var s=t.children[i];s!=null&&$t(e,s)}}break}}function Mt(e){if(typeof e.tag!="string"&&typeof e.state.onremove=="function"&&h.call(e.state.onremove,e),e.attrs&&typeof e.attrs.onremove=="function"&&h.call(e.attrs.onremove,e),typeof e.tag!="string")e.instance!=null&&Mt(e.instance);else{var t=e.children;if(Array.isArray(t))for(var i=0;i<t.length;i++){var s=t[i];s!=null&&Mt(s)}}}function ar(e,t,i){for(var s in t)kt(e,s,null,t[s],i)}function kt(e,t,i,s,c){if(!(t==="key"||t==="is"||s==null||jt(t)||i===s&&!lr(e,t)&&typeof s!="object")){if(t[0]==="o"&&t[1]==="n")return he(e,t,s);if(t.slice(0,6)==="xlink:")e.dom.setAttributeNS("http://www.w3.org/1999/xlink",t.slice(6),s);else if(t==="style")ue(e.dom,i,s);else if(fe(e,t,c)){if(t==="value"&&((e.tag==="input"||e.tag==="textarea")&&e.dom.value===""+s&&e.dom===u()||e.tag==="select"&&i!==null&&e.dom.value===""+s||e.tag==="option"&&i!==null&&e.dom.value===""+s))return;e.tag==="input"&&t==="type"?e.dom.setAttribute(t,s):e.dom[t]=s}else typeof s=="boolean"?s?e.dom.setAttribute(t,""):e.dom.removeAttribute(t):e.dom.setAttribute(t==="className"?"class":t,s)}}function sr(e,t,i,s){if(!(t==="key"||t==="is"||i==null||jt(t)))if(t[0]==="o"&&t[1]==="n"&&!jt(t))he(e,t,void 0);else if(t==="style")ue(e.dom,i,null);else if(fe(e,t,s)&&t!=="className"&&!(t==="value"&&(e.tag==="option"||e.tag==="select"&&e.dom.selectedIndex===-1&&e.dom===u()))&&!(e.tag==="input"&&t==="type"))e.dom[t]=null;else{var c=t.indexOf(":");c!==-1&&(t=t.slice(c+1)),i!==!1&&e.dom.removeAttribute(t==="className"?"class":t)}}function or(e,t){if("value"in t)if(t.value===null)e.dom.selectedIndex!==-1&&(e.dom.value=null);else{var i=""+t.value;(e.dom.value!==i||e.dom.selectedIndex===-1)&&(e.dom.value=i)}"selectedIndex"in t&&kt(e,"selectedIndex",null,t.selectedIndex,void 0)}function cr(e,t,i,s){if(i!=null)for(var c in i)kt(e,c,t&&t[c],i[c],s);var d;if(t!=null)for(var c in t)(d=t[c])!=null&&(i==null||i[c]==null)&&sr(e,c,d,s)}function lr(e,t){return t==="value"||t==="checked"||t==="selectedIndex"||t==="selected"&&e.dom===u()||e.tag==="option"&&e.dom.parentNode===r.activeElement}function jt(e){return e==="oninit"||e==="oncreate"||e==="onupdate"||e==="onremove"||e==="onbeforeremove"||e==="onbeforeupdate"}function fe(e,t,i){return i===void 0&&(e.tag.indexOf("-")>-1||e.attrs!=null&&e.attrs.is||t!=="href"&&t!=="list"&&t!=="form"&&t!=="width"&&t!=="height")&&t in e.dom}var fr=/[A-Z]/g;function ur(e){return"-"+e.toLowerCase()}function Ft(e){return e[0]==="-"&&e[1]==="-"?e:e==="cssFloat"?"float":e.replace(fr,ur)}function ue(e,t,i){if(t!==i)if(i==null)e.style.cssText="";else if(typeof i!="object")e.style.cssText=i;else if(t==null||typeof t!="object"){e.style.cssText="";for(var s in i){var c=i[s];c!=null&&e.style.setProperty(Ft(s),String(c))}}else{for(var s in i){var c=i[s];c!=null&&(c=String(c))!==String(t[s])&&e.style.setProperty(Ft(s),c)}for(var s in t)t[s]!=null&&i[s]==null&&e.style.removeProperty(Ft(s))}}function _t(){this._=a}_t.prototype=Object.create(null),_t.prototype.handleEvent=function(e){var t=this["on"+e.type],i;typeof t=="function"?i=t.call(e.currentTarget,e):typeof t.handleEvent=="function"&&t.handleEvent(e),this._&&e.redraw!==!1&&(0,this._)(),i===!1&&(e.preventDefault(),e.stopPropagation())};function he(e,t,i){if(e.events!=null){if(e.events[t]===i)return;i!=null&&(typeof i=="function"||typeof i=="object")?(e.events[t]==null&&e.dom.addEventListener(t.slice(2),e.events,!1),e.events[t]=i):(e.events[t]!=null&&e.dom.removeEventListener(t.slice(2),e.events,!1),e.events[t]=void 0)}else i!=null&&(typeof i=="function"||typeof i=="object")&&(e.events=new _t,e.dom.addEventListener(t.slice(2),e.events,!1),e.events[t]=i)}function Ht(e,t,i){typeof e.oninit=="function"&&h.call(e.oninit,t),typeof e.oncreate=="function"&&i.push(h.bind(e.oncreate,t))}function Bt(e,t,i){typeof e.onupdate=="function"&&i.push(h.bind(e.onupdate,t))}function hr(e,t){do{if(e.attrs!=null&&typeof e.attrs.onbeforeupdate=="function"){var i=h.call(e.attrs.onbeforeupdate,e,t);if(i!==void 0&&!i)break}if(typeof e.tag!="string"&&typeof e.state.onbeforeupdate=="function"){var i=h.call(e.state.onbeforeupdate,e,t);if(i!==void 0&&!i)break}return!1}while(!1);return e.dom=t.dom,e.domSize=t.domSize,e.instance=t.instance,e.attrs=t.attrs,e.children=t.children,e.text=t.text,!0}return function(e,t,i){if(!e)throw new TypeError("Ensure the DOM element being passed to m.route/m.mount/m.render is not undefined.");var s=[],c=u(),d=e.namespaceURI;e.vnodes==null&&(e.textContent=""),t=ut.normalizeChildren(Array.isArray(t)?t:[t]);var C=a;try{a=typeof i=="function"?i:void 0,A(e,e.vnodes,t,s,null,d==="http://www.w3.org/1999/xhtml"?void 0:d)}finally{a=C}e.vnodes=t,c!=null&&u()!==c&&typeof c.focus=="function"&&c.focus();for(var E=0;E<s.length;E++)s[E]()}}});var re=q((ni,Le)=>{"use strict";Le.exports=De()(window)});var Ne=q((ai,Se)=>{"use strict";var Ve=et();Se.exports=function(n,r,a){var o=[],p=!1,l=!1;function h(){if(p)throw new Error("Nested m.redraw.sync() call");p=!0;for(var m=0;m<o.length;m+=2)try{n(o[m],Ve(o[m+1]),u)}catch(g){a.error(g)}p=!1}function u(){l||(l=!0,r(function(){l=!1,h()}))}u.sync=h;function f(m,g){if(g!=null&&g.view==null&&typeof g!="function")throw new TypeError("m.mount(element, component) expects a component, not a vnode");var w=o.indexOf(m);w>=0&&(o.splice(w,2),n(m,[],u)),g!=null&&(o.push(m,g),n(m,Ve(g),u))}return{mount:f,redraw:u}}});var Tt=q((si,ze)=>{"use strict";var qr=re();ze.exports=Ne()(qr,requestAnimationFrame,console)});var ie=q((oi,Ie)=>{"use strict";Ie.exports=function(n){if(Object.prototype.toString.call(n)!=="[object Object]")return"";var r=[];for(var a in n)o(a,n[a]);return r.join("&");function o(p,l){if(Array.isArray(l))for(var h=0;h<l.length;h++)o(p+"["+h+"]",l[h]);else if(Object.prototype.toString.call(l)==="[object Object]")for(var h in l)o(p+"["+h+"]",l[h]);else r.push(encodeURIComponent(p)+(l!=null&&l!==""?"="+encodeURIComponent(l):""))}}});var ne=q((ci,$e)=>{"use strict";$e.exports=Object.assign||function(n,r){r&&Object.keys(r).forEach(function(a){n[a]=r[a]})}});var Pt=q((li,ke)=>{"use strict";var Dr=ie(),Lr=ne();ke.exports=function(n,r){if(/:([^\/\.-]+)(\.{3})?:/.test(n))throw new SyntaxError("Template parameter names *must* be separated");if(r==null)return n;var a=n.indexOf("?"),o=n.indexOf("#"),p=o<0?n.length:o,l=a<0?p:a,h=n.slice(0,l),u={};Lr(u,r);var f=h.replace(/:([^\/\.-]+)(\.{3})?/g,function(b,R,A){return delete u[R],r[R]==null?b:A?r[R]:encodeURIComponent(String(r[R]))}),m=f.indexOf("?"),g=f.indexOf("#"),w=g<0?f.length:g,x=m<0?w:m,y=f.slice(0,x);a>=0&&(y+=n.slice(a,p)),m>=0&&(y+=(a<0?"?":"&")+f.slice(m,w));var M=Dr(u);return M&&(y+=(a<0&&m<0?"?":"&")+M),o>=0&&(y+=n.slice(o)),g>=0&&(y+=(o<0?"":"&")+f.slice(g)),y}});var Fe=q((fi,je)=>{"use strict";var Vr=Pt();je.exports=function(n,r,a){var o=0;function p(u){return new r(u)}p.prototype=r.prototype,p.__proto__=r;function l(u){return function(f,m){typeof f!="string"?(m=f,f=f.url):m==null&&(m={});var g=new r(function(M,b){u(Vr(f,m.params),m,function(R){if(typeof m.type=="function")if(Array.isArray(R))for(var A=0;A<R.length;A++)R[A]=new m.type(R[A]);else R=new m.type(R);M(R)},b)});if(m.background===!0)return g;var w=0;function x(){--w==0&&typeof a=="function"&&a()}return y(g);function y(M){var b=M.then;return M.constructor=p,M.then=function(){w++;var R=b.apply(M,arguments);return R.then(x,function(A){if(x(),w===0)throw A}),y(R)},M}}}function h(u,f){for(var m in u.headers)if({}.hasOwnProperty.call(u.headers,m)&&f.test(m))return!0;return!1}return{request:l(function(u,f,m,g){var w=f.method!=null?f.method.toUpperCase():"GET",x=f.body,y=(f.serialize==null||f.serialize===JSON.serialize)&&!(x instanceof n.FormData),M=f.responseType||(typeof f.extract=="function"?"":"json"),b=new n.XMLHttpRequest,R=!1,A=b,S,it=b.abort;b.abort=function(){R=!0,it.call(this)},b.open(w,u,f.async!==!1,typeof f.user=="string"?f.user:void 0,typeof f.password=="string"?f.password:void 0),y&&x!=null&&!h(f,/^content-type$/i)&&b.setRequestHeader("Content-Type","application/json; charset=utf-8"),typeof f.deserialize!="function"&&!h(f,/^accept$/i)&&b.setRequestHeader("Accept","application/json, text/*"),f.withCredentials&&(b.withCredentials=f.withCredentials),f.timeout&&(b.timeout=f.timeout),b.responseType=M;for(var nt in f.headers)({}).hasOwnProperty.call(f.headers,nt)&&b.setRequestHeader(nt,f.headers[nt]);b.onreadystatechange=function(N){if(!R&&N.target.readyState===4)try{var P=N.target.status>=200&&N.target.status<300||N.target.status===304||/^file:\/\//i.test(u),$=N.target.response,Y;if(M==="json"?!N.target.responseType&&typeof f.extract!="function"&&($=JSON.parse(N.target.responseText)):(!M||M==="text")&&$==null&&($=N.target.responseText),typeof f.extract=="function"?($=f.extract(N.target,f),P=!0):typeof f.deserialize=="function"&&($=f.deserialize($)),P)m($);else{try{Y=N.target.responseText}catch(at){Y=$}var U=new Error(Y);U.code=N.target.status,U.response=$,g(U)}}catch(at){g(at)}},typeof f.config=="function"&&(b=f.config(b,f,u)||b,b!==A&&(S=b.abort,b.abort=function(){R=!0,S.call(this)})),x==null?b.send():typeof f.serialize=="function"?b.send(f.serialize(x)):x instanceof n.FormData?b.send(x):b.send(JSON.stringify(x))}),jsonp:l(function(u,f,m,g){var w=f.callbackName||"_mithril_"+Math.round(Math.random()*1e16)+"_"+o++,x=n.document.createElement("script");n[w]=function(y){delete n[w],x.parentNode.removeChild(x),m(y)},x.onerror=function(){delete n[w],x.parentNode.removeChild(x),g(new Error("JSONP request failed"))},x.src=u+(u.indexOf("?")<0?"?":"&")+encodeURIComponent(f.callbackKey||"callback")+"="+encodeURIComponent(w),n.document.documentElement.appendChild(x)})}}});var He=q((ui,_e)=>{"use strict";var Sr=ee(),Nr=Tt();_e.exports=Fe()(window,Sr,Nr.redraw)});var ae=q((hi,Be)=>{"use strict";Be.exports=function(n){if(n===""||n==null)return{};n.charAt(0)==="?"&&(n=n.slice(1));for(var r=n.split("&"),a={},o={},p=0;p<r.length;p++){var l=r[p].split("="),h=decodeURIComponent(l[0]),u=l.length===2?decodeURIComponent(l[1]):"";u==="true"?u=!0:u==="false"&&(u=!1);var f=h.split(/\]\[?|\[/),m=o;h.indexOf("[")>-1&&f.pop();for(var g=0;g<f.length;g++){var w=f[g],x=f[g+1],y=x==""||!isNaN(parseInt(x,10));if(w===""){var h=f.slice(0,g).join();a[h]==null&&(a[h]=Array.isArray(m)?m.length:0),w=a[h]++}else if(w==="__proto__")break;if(g===f.length-1)m[w]=u;else{var M=Object.getOwnPropertyDescriptor(m,w);M!=null&&(M=M.value),M==null&&(m[w]=M=y?[]:{}),m=M}}}return o}});var Ot=q((pi,Ue)=>{"use strict";var zr=ae();Ue.exports=function(n){var r=n.indexOf("?"),a=n.indexOf("#"),o=a<0?n.length:a,p=r<0?o:r,l=n.slice(0,p).replace(/\/{2,}/g,"/");return l?(l[0]!=="/"&&(l="/"+l),l.length>1&&l[l.length-1]==="/"&&(l=l.slice(0,-1))):l="/",{path:l,params:r<0?{}:zr(n.slice(r+1,o))}}});var Ke=q((mi,Ge)=>{"use strict";var Ir=Ot();Ge.exports=function(n){var r=Ir(n),a=Object.keys(r.params),o=[],p=new RegExp("^"+r.path.replace(/:([^\/.-]+)(\.{3}|\.(?!\.)|-)?|[\\^$*+.()|\[\]{}]/g,function(l,h,u){return h==null?"\\"+l:(o.push({k:h,r:u==="..."}),u==="..."?"(.*)":u==="."?"([^/]+)\\.":"([^/]+)"+(u||""))})+"$");return function(l){for(var h=0;h<a.length;h++)if(r.params[a[h]]!==l.params[a[h]])return!1;if(!o.length)return p.test(l.path);var u=p.exec(l.path);if(u==null)return!1;for(var h=0;h<o.length;h++)l.params[o[h].k]=o[h].r?u[h+1]:decodeURIComponent(u[h+1]);return!0}}});var Je=q((di,Qe)=>{"use strict";var $r=et(),kr=Yt(),jr=ee(),Fr=Pt(),We=Ot(),_r=Ke(),Xe=ne(),se={};Qe.exports=function(n,r){var a;function o(w,x,y){if(w=Fr(w,x),a!=null){a();var M=y?y.state:null,b=y?y.title:null;y&&y.replace?n.history.replaceState(M,b,g.prefix+w):n.history.pushState(M,b,g.prefix+w)}else n.location.href=g.prefix+w}var p=se,l,h,u,f,m=g.SKIP={};function g(w,x,y){if(w==null)throw new Error("Ensure the DOM element that was passed to `m.route` is not undefined");var M=0,b=Object.keys(y).map(function(P){if(P[0]!=="/")throw new SyntaxError("Routes must start with a `/`");if(/:([^\/\.-]+)(\.{3})?:/.test(P))throw new SyntaxError("Route parameter names must be separated with either `/`, `.`, or `-`");return{route:P,component:y[P],check:_r(P)}}),R=typeof setImmediate=="function"?setImmediate:setTimeout,A=jr.resolve(),S=!1,it;if(a=null,x!=null){var nt=We(x);if(!b.some(function(P){return P.check(nt)}))throw new ReferenceError("Default route doesn't match any known routes")}function N(){S=!1;var P=n.location.hash;g.prefix[0]!=="#"&&(P=n.location.search+P,g.prefix[0]!=="?"&&(P=n.location.pathname+P,P[0]!=="/"&&(P="/"+P)));var $=P.concat().replace(/(?:%[a-f89][a-f0-9])+/gim,decodeURIComponent).slice(g.prefix.length),Y=We($);Xe(Y.params,n.history.state);function U(){if($===x)throw new Error("Could not resolve default route "+x);o(x,null,{replace:!0})}at(0);function at(Q){for(;Q<b.length;Q++)if(b[Q].check(Y)){var K=b[Q].component,vt=b[Q].route,st=K,ot=f=function(J){if(ot===f){if(J===m)return at(Q+1);l=J!=null&&(typeof J.view=="function"||typeof J=="function")?J:"div",h=Y.params,u=$,f=null,p=K.render?K:null,M===2?r.redraw():(M=2,r.redraw.sync())}};K.view||typeof K=="function"?(K={},ot(st)):K.onmatch?A.then(function(){return K.onmatch(Y.params,$,vt)}).then(ot,U):ot("div");return}U()}}return a=function(){S||(S=!0,R(N))},typeof n.history.pushState=="function"?(it=function(){n.removeEventListener("popstate",a,!1)},n.addEventListener("popstate",a,!1)):g.prefix[0]==="#"&&(a=null,it=function(){n.removeEventListener("hashchange",N,!1)},n.addEventListener("hashchange",N,!1)),r.mount(w,{onbeforeupdate:function(){return M=M?2:1,!(!M||se===p)},oncreate:N,onremove:it,view:function(){if(!(!M||se===p)){var P=[$r(l,h.key,h)];return p&&(P=p.render(P[0])),P}}})}return g.set=function(w,x,y){f!=null&&(y=y||{},y.replace=!0),f=null,o(w,x,y)},g.get=function(){return u},g.prefix="#!",g.Link={view:function(w){var x=w.attrs.options,y={},M,b;Xe(y,w.attrs),y.selector=y.options=y.key=y.oninit=y.oncreate=y.onbeforeupdate=y.onupdate=y.onbeforeremove=y.onremove=null;var R=kr(w.attrs.selector||"a",y,w.children);return(R.attrs.disabled=Boolean(R.attrs.disabled))?(R.attrs.href=null,R.attrs["aria-disabled"]="true",R.attrs.onclick=null):(M=R.attrs.onclick,b=R.attrs.href,R.attrs.href=g.prefix+b,R.attrs.onclick=function(A){var S;typeof M=="function"?S=M.call(A.currentTarget,A):M==null||typeof M!="object"||typeof M.handleEvent=="function"&&M.handleEvent(A),S!==!1&&!A.defaultPrevented&&(A.button===0||A.which===0||A.which===1)&&(!A.currentTarget.target||A.currentTarget.target==="_self")&&!A.ctrlKey&&!A.metaKey&&!A.shiftKey&&!A.altKey&&(A.preventDefault(),A.redraw=!1,g.set(b,null,x))}),R}},g.param=function(w){return h&&w!=null?h[w]:h},g}});var Ze=q((gi,Ye)=>{"use strict";var Hr=Tt();Ye.exports=Je()(window,Hr)});var Z=q((yi,rr)=>{"use strict";var qt=Pe(),tr=He(),er=Tt(),j=function(){return qt.apply(this,arguments)};j.m=qt;j.trust=qt.trust;j.fragment=qt.fragment;j.mount=er.mount;j.route=Ze();j.render=re();j.redraw=er.redraw;j.request=tr.request;j.jsonp=tr.jsonp;j.parseQueryString=ae();j.buildQueryString=ie();j.parsePathname=Ot();j.buildPathname=Pt();j.vnode=et();j.PromisePolyfill=te();rr.exports=j});var B=tt(Z());var G=tt(Z());var bt=tt(Z()),F=class{view(r){return r.attrs.a?(0,bt.default)("a",Rt({class:`button ${r.attrs.primary?"primary":"secondary"} ${r.attrs.label?"":"icon-only"} ${r.attrs.outline?"outline":""}`},r.attrs.a),[(0,bt.default)("img",{src:`https://icongr.am/${r.attrs.iconset||"octicons"}/${r.attrs.icon}.svg?size=16&color=${r.attrs.outline?"333333":"ffffff"}`}),r.attrs.label]):(0,bt.default)("button",{class:`button ${r.attrs.primary?"primary":"secondary"} ${r.attrs.label?"":"icon-only"} ${r.attrs.outline?"outline":""}`,onclick:r.attrs.onclick,title:r.attrs.title||r.attrs.label,disabled:r.attrs.disabled},[(0,bt.default)("img",{src:`https://icongr.am/${r.attrs.iconset||"octicons"}/${r.attrs.icon}.svg?size=16&color=${r.attrs.outline?"333333":"ffffff"}`}),r.attrs.label])}};var oe=tt(Z());function Br(n){let r=Math.floor(n/1e3),a=Math.floor(r/60),o=r%60,p=`${o<10?"0":""}${o}`;return`${a>0?`${a<10?"0":""}${a}`:"00"}:${p}`}var ht=class{view(r){return(0,oe.default)("span.tag.is-small",[(0,oe.default)("img",{src:"https://icongr.am/octicons/clock.svg?size=16&color=333333"}),Br(r.attrs.duration)])}};var Dt=tt(Z()),W=class{view(r){return(0,Dt.default)("section",{class:"view"},[(0,Dt.default)("section",Rt({class:`content ${r.attrs.contentClass||""}`},r.attrs.contentProps||{}),r.children),(0,Dt.default)("section",{class:"actions"},r.attrs.actions)])}};function Ur(n){return n<1024?"1 KB":(n=Math.round(n/1024),n<1024?`${n} KB`:`${Math.floor(n/1024*100)/100} MB`)}function pt(n,r){return String(n).padStart(r,"0")}var Lt=class{constructor(r){this.app=r.attrs.app,this.gif=r.attrs.gif}view(){let r=new Date,a=`Recording ${pt(r.getFullYear(),4)}-${pt(r.getMonth()+1,2)}-${pt(r.getDate(),2)} at ${pt(r.getHours(),2)}.${pt(r.getMinutes(),2)}.${pt(r.getSeconds(),2)}.gif`,o=[(0,G.default)(F,{label:"Download",icon:"download",a:{href:this.gif.url,download:a,target:"_blank"},primary:!0}),(0,G.default)(F,{label:"Edit",icon:"pencil",onclick:()=>this.app.editGif()}),(0,G.default)(F,{label:"Discard",icon:"trashcan",onclick:()=>this.app.discardGif()})];return[(0,G.default)(W,{actions:o},(0,G.default)(".recording-card",[(0,G.default)("a",{href:this.gif.url,download:a,target:"_blank"},[(0,G.default)("img.recording",{src:this.gif.url})]),(0,G.default)("footer",[(0,G.default)(ht,{duration:this.gif.duration}),(0,G.default)("span.tag.is-small",[(0,G.default)("a.recording-detail",{href:this.gif.url,download:a,target:"_blank"},[(0,G.default)("img",{src:"https://icongr.am/octicons/download.svg?size=16&color=333333"}),Ur(this.gif.size)])])])]))]}};var V=tt(Z());function mt(n,r,a=0,o=n.length-1){let p=o-a;if(p===0)return a;if(p===1)return r<n[o].timestamp?a:o;let l=Math.floor((o+a)/2),h=n[l].timestamp;return r===h?l:r<h?mt(n,r,a,l):mt(n,r,l,o)}var ce=()=>null,X=window.devicePixelRatio||1,Vt=class{constructor(r){this.didDraw=!1;this.didResize=!1;var p,l;this.app=r.attrs.app,this.recording=r.attrs.recording,this.duration=this.recording.frames[this.recording.frames.length-1].timestamp+this.app.frameLength,this.mouse={x:0,y:0},this.viewport={width:0,height:0,top:0,left:0,scale:1};let a=r.attrs.renderOptions?this.recording.frames[r.attrs.renderOptions.trim.start].timestamp:0,o=r.attrs.renderOptions?this.recording.frames[r.attrs.renderOptions.trim.end].timestamp:this.duration;this.playback={head:a,start:a,offset:0,end:o,disposable:ce},this.trim={start:a,end:o},this.crop=(l=(p=r.attrs.renderOptions)==null?void 0:p.crop)!=null?l:{top:0,left:0,width:this.recording.width,height:this.recording.height}}get isPlaying(){return this.playback.disposable!==ce}async oncreate(r){this.sourceCanvas=r.dom.querySelector("canvas.source"),this.sourceCtx=this.sourceCanvas.getContext("2d"),this.canvas=r.dom.querySelector("canvas.target"),this.ctx=this.canvas.getContext("2d"),this.matrix=this.ctx.getTransform(),this.playbar=r.dom.querySelector(".playbar"),this.content=r.dom.querySelector(".content");let a=()=>this.onDidResize();window.addEventListener("resize",a),this.viewportDisposable=()=>window.removeEventListener("resize",a),this.onDidResize(),this.zoomToFit(),setTimeout(()=>this.play())}zoomToFit(){this.viewport.top=(this.recording.height-this.viewport.height*X)/-2,this.viewport.left=(this.recording.width-this.viewport.width*X)/-2,this.initialScale=Math.max(.1,Math.min(1,this.viewport.width*X*.95/this.recording.width,this.viewport.height*X*.95/this.recording.height))}onDidResize(){let r=Math.floor(this.content.clientWidth),a=Math.floor(this.content.clientHeight);this.viewport.left+=Math.round((r-this.viewport.width)/this.viewport.scale/2),this.viewport.top+=Math.round((a-this.viewport.height)/this.viewport.scale/2),this.viewport.width=r,this.viewport.height=a,this.didResize=!0,V.default.redraw()}onbeforeremove(){this.pause(),this.viewportDisposable()}view(){let r=[(0,V.default)(F,{title:this.isPlaying?"Pause":"Play",iconset:"material",icon:this.isPlaying?"pause":"play",primary:!0,onclick:()=>this.togglePlayPause()}),(0,V.default)(".playbar",[(0,V.default)("input",{type:"range",min:0,max:`${this.duration}`,value:`${this.playback.head}`,disabled:this.isPlaying,oninput:a=>this.onPlaybarInput(a)}),(0,V.default)(".trim-bar",{style:{left:`${this.trim.start*100/this.duration}%`,width:`${(this.trim.end-this.trim.start)*100/this.duration}%`}},[(0,V.default)(".trim-start",{onmousedown:a=>this.onTrimMouseDown("start",a)}),(0,V.default)(".trim-end",{onmousedown:a=>this.onTrimMouseDown("end",a)})])]),(0,V.default)(F,{label:"Render",icon:"gear",onclick:()=>this.startRendering(),primary:!0}),(0,V.default)(F,{title:"Discard",icon:"trashcan",onclick:()=>this.app.discardGif()})];return[(0,V.default)(W,{actions:r,contentClass:"crop",contentProps:{onmousemove:a=>this.onMouseMove(a),onmousedown:a=>this.onMouseDown(a),oncontextmenu:a=>a.preventDefault()}},[(0,V.default)("canvas",{class:"source",width:this.recording.width,height:this.recording.height}),(0,V.default)("canvas",{class:"target",width:Math.floor(this.viewport.width*X),height:Math.floor(this.viewport.height*X),onwheel:a=>this.onContentWheel(a)})])]}onTrimMouseDown(r,a){a.preventDefault();let o=this.isPlaying,p=this.playback.head;this.pause();let l={width:this.playbar.clientWidth,screenX:a.screenX,head:r==="start"?this.trim.start:this.trim.end,min:r==="start"?0:this.trim.start+this.app.frameLength,max:r==="start"?this.trim.end-this.app.frameLength:this.duration},h=f=>{let m=f.screenX-l.screenX,g=l.head+Math.round(m*this.duration/l.width);this.playback.head=g,this.trim[r]=Math.max(l.min,Math.min(l.max,g)),V.default.redraw()},u=()=>{document.body.removeEventListener("mousemove",h),document.body.removeEventListener("mouseup",u),this.playback.start=this.trim.start,this.playback.end=this.trim.end,o?(this.playback.head=this.trim.start,this.play()):this.playback.head=Math.max(this.playback.start,Math.min(this.playback.end,p)),V.default.redraw()};document.body.addEventListener("mousemove",h),document.body.addEventListener("mouseup",u)}onContentWheel(r){r.preventDefault();let a=Math.pow(1.1,-r.deltaY/90);this.setScale(this.viewport.scale*a,this.mouse),this.drawFrame()}setScale(r,a={x:this.viewport.width/2,y:this.viewport.height/2}){r=Math.max(.2,Math.min(3,r));let o=r/this.viewport.scale,l=this.matrix.inverse().transformPoint({x:a.x*X,y:a.y*X});this.ctx.translate(l.x,l.y),this.ctx.scale(o,o),this.ctx.translate(-l.x,-l.y),this.matrix=this.ctx.getTransform(),this.viewport.scale=r}onMouseMove(r){this.mouse.x=r.clientX,this.mouse.y=r.clientY}onMouseDown(r){r.ctrlKey||r.metaKey||r.shiftKey||r.altKey||r.button>0?this.onViewportMove(r):this.onCrop(r)}onCrop(r){let a=this.matrix.inverse(),o=f=>{let m=a.transformPoint({x:f.clientX*X,y:f.clientY*X});return{x:Math.max(Math.min(Math.floor(m.x)-this.viewport.left,this.recording.width),0),y:Math.max(Math.min(Math.floor(m.y)-this.viewport.top,this.recording.height),0)}},p=o(r),l=!1,h=f=>{let m=o(f);this.crop.top=Math.floor(Math.max(0,Math.min(p.y,m.y))),this.crop.left=Math.floor(Math.max(0,Math.min(p.x,m.x))),this.crop.width=Math.floor(Math.min(this.recording.width-this.crop.left,Math.abs(p.x-m.x))),this.crop.height=Math.floor(Math.min(this.recording.height-this.crop.top,Math.abs(p.y-m.y))),l=!0,V.default.redraw()},u=f=>{f.preventDefault(),document.body.removeEventListener("mousemove",h),document.body.removeEventListener("mouseup",u),(!l||this.crop.width<10||this.crop.height<10)&&(this.crop.top=0,this.crop.left=0,this.crop.width=this.recording.width,this.crop.height=this.recording.height),V.default.redraw()};r.preventDefault(),document.body.addEventListener("mousemove",h),document.body.addEventListener("mouseup",u)}onViewportMove(r){let a=this.matrix.inverse(),o=u=>{let f=a.transformPoint({x:u.clientX*X,y:u.clientY*X});return{x:Math.floor(f.x),y:Math.floor(f.y)}},p={top:this.viewport.top,left:this.viewport.left,point:o(r)},l=u=>{let f=o(u);this.viewport.top=p.top+f.y-p.point.y,this.viewport.left=p.left+f.x-p.point.x,V.default.redraw()},h=u=>{u.preventDefault(),document.body.removeEventListener("mousemove",l),document.body.removeEventListener("mouseup",h),V.default.redraw()};r.preventDefault(),document.body.addEventListener("mousemove",l),document.body.addEventListener("mouseup",h)}onPlaybarInput(r){this.playback.head=r.target.valueAsNumber;let a=mt(this.recording.frames,this.playback.head);this.ctx.putImageData(this.recording.frames[a].imageData,0,0)}play(){this.playback.disposable();let r;this.playback.head=Math.max(this.playback.start,Math.min(this.playback.end,this.playback.head)),this.playback.offset=Date.now()-this.playback.head+this.playback.start;let a=()=>{this.playback.head=this.playback.start+(Date.now()-this.playback.offset)%(this.playback.end-this.playback.start),V.default.redraw(),r=requestAnimationFrame(a)};r=requestAnimationFrame(a),this.playback.disposable=()=>cancelAnimationFrame(r)}onupdate(){this.didResize&&(this.ctx.setTransform(this.matrix),this.didResize=!1),this.drawFrame()}drawFrame(){!this.didDraw&&this.initialScale!==1&&this.setScale(this.initialScale);let r=mt(this.recording.frames,this.playback.head);this.sourceCtx.putImageData(this.recording.frames[r].imageData,0,0);let a=this.ctx.getTransform();this.ctx.setTransform(),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.setTransform(a),this.ctx.drawImage(this.sourceCanvas,this.viewport.left,this.viewport.top),(this.crop.top!==0||this.crop.left!==0||this.crop.width!==this.recording.width||this.crop.height!==this.recording.height)&&(this.ctx.beginPath(),this.ctx.moveTo(this.viewport.left,this.viewport.top),this.ctx.lineTo(this.viewport.left+this.recording.width,this.viewport.top),this.ctx.lineTo(this.viewport.left+this.recording.width,this.viewport.top+this.recording.height),this.ctx.lineTo(this.viewport.left,this.viewport.top+this.recording.height),this.ctx.lineTo(this.viewport.left,this.viewport.top),this.ctx.closePath(),this.ctx.moveTo(this.viewport.left+this.crop.left,this.viewport.top+this.crop.top),this.ctx.lineTo(this.viewport.left+this.crop.left,this.viewport.top+this.crop.top+this.crop.height),this.ctx.lineTo(this.viewport.left+this.crop.left+this.crop.width,this.viewport.top+this.crop.top+this.crop.height),this.ctx.lineTo(this.viewport.left+this.crop.left+this.crop.width,this.viewport.top+this.crop.top),this.ctx.lineTo(this.viewport.left+this.crop.left,this.viewport.top+this.crop.top),this.ctx.closePath(),this.ctx.fillStyle="#00000055",this.ctx.fill()),this.didDraw=!0}pause(){this.playback.disposable(),this.playback.disposable=ce}togglePlayPause(){this.isPlaying?this.pause():this.play()}startRendering(){this.app.startRendering({trim:{start:mt(this.recording.frames,this.trim.start),end:mt(this.recording.frames,this.trim.end)},crop:this.crop})}};var rt=tt(Z());var St=class{constructor(r){this.startTime=0;this.width=0;this.height=0;this.frames=[];this.app=r.attrs.app,this.captureStream=r.attrs.captureStream}async oncreate(r){let a=r.dom.getElementsByTagName("video")[0],o=r.dom.getElementsByTagName("canvas")[0];a.srcObject=this.captureStream;let p=o.getContext("2d"),l=new Worker("ticker.js");l.postMessage(this.app.frameLength),l.onmessage=()=>{if(a.videoWidth===0)return;let m=this.startTime===0;if(m){let w=a.videoWidth,x=a.videoHeight;this.startTime=Date.now(),this.width=w,this.height=x,o.width=w,o.height=x}p.drawImage(a,0,0);let g=p.getImageData(0,0,this.width,this.height);this.frames.push({imageData:g,timestamp:m?0:Date.now()-this.startTime})};let h=setInterval(()=>rt.default.redraw(),this.app.frameLength),u=this.captureStream.getVideoTracks()[0],f=()=>this.stopRecording();u.addEventListener("ended",f),this._onbeforeremove=()=>{l.terminate(),clearInterval(h),u.removeEventListener("ended",f),u.stop()},rt.default.redraw()}onbeforeremove(){this._onbeforeremove&&this._onbeforeremove()}view(){return[(0,rt.default)(W,[(0,rt.default)("p",[(0,rt.default)(ht,{duration:this.startTime===0?0:Date.now()-this.startTime})]),(0,rt.default)(F,{label:"Stop Recording",icon:"square-fill",onclick:()=>this.stopRecording()}),(0,rt.default)("canvas.hidden",{width:640,height:480}),(0,rt.default)("video.hidden",{autoplay:!0,playsinline:!0})])]}stopRecording(){this.app.stopRecording({width:this.width,height:this.height,frames:this.frames})}};var dt=tt(Z());var Nt=class{constructor(r){this.progress=0;this.app=r.attrs.app,this.recording=r.attrs.recording,this.renderOptions=r.attrs.renderOptions}async oncreate(r){let a=new GifEncoder({width:this.renderOptions.crop.width,height:this.renderOptions.crop.height});a.on("progress",l=>{this.progress=l,dt.default.redraw()}),a.once("finished",l=>{let h=URL.createObjectURL(l),u=this.recording.frames[this.renderOptions.trim.end].timestamp-this.recording.frames[this.renderOptions.trim.start].timestamp+this.app.frameLength;this.app.finishRendering({blob:l,url:h,duration:u,size:l.size})});let o=r.dom.getElementsByTagName("canvas")[0].getContext("2d"),p=l=>{if(l>this.renderOptions.trim.end){this._onbeforeremove=()=>a.abort(),a.render();return}let h=this.recording.frames[l],u=h.imageData;o.putImageData(u,0,0),u=o.getImageData(this.renderOptions.crop.left,this.renderOptions.crop.top,this.renderOptions.crop.width,this.renderOptions.crop.height);let f=l<this.renderOptions.trim.end?this.recording.frames[l+1].timestamp-h.timestamp:this.app.frameLength;a.addFrame(u,f),setTimeout(()=>p(l+1),0)};p(this.renderOptions.trim.start)}view(){let r=[(0,dt.default)(F,{label:"Cancel",icon:"square-fill",onclick:()=>this.app.cancelRendering()})];return[(0,dt.default)(W,{actions:r},[(0,dt.default)("progress",{max:"1",value:this.progress,title:"Rendering..."},`Rendering: ${Math.floor(this.progress*100)}%`),(0,dt.default)("canvas.hidden",{width:this.recording.width,height:this.recording.height})])]}onbeforeremove(){this._onbeforeremove&&this._onbeforeremove()}};var gt=tt(Z());var ir=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),zt=class{constructor(r){this.app=r.attrs.app}view(){return(0,gt.default)(W,[(0,gt.default)("p","Create animated GIFs from a screen recording."),(0,gt.default)("p","Client-side only, no data is uploaded. Modern browser required."),ir?(0,gt.default)("p","Sorry, mobile does not support screen recording."):void 0,ir?void 0:(0,gt.default)(F,{label:"Start Recording",icon:"play",onclick:()=>this.app.startRecording(),primary:!0})])}};var Gr=12;function It(n,r){if(n!==r)throw new Error("Invalid state")}var nr=class{constructor(){this.frameLength=Math.floor(1e3/Gr);this._state={name:"start"};window.onbeforeunload=()=>this.state.name!=="start"?"":null}get state(){return this._state}set state(r){this._state=r,B.default.redraw()}view(){return(0,B.default)("section",{id:"app",class:this.state.name==="start"?"home":""},[(0,B.default)("section",{id:"app-body"},[(0,B.default)("h1",[(0,B.default)("span",{class:"gif"},"gif"),(0,B.default)("span",{class:"cap"},"cap")]),this.body()])])}body(){switch(this.state.name){case"start":return(0,B.default)(zt,{app:this});case"playing":return(0,B.default)(Lt,{app:this,gif:this.state.gif});case"recording":return(0,B.default)(St,{app:this,captureStream:this.state.captureStream});case"previewing":return(0,B.default)(Vt,{app:this,recording:this.state.recording,renderOptions:this.state.renderOptions});case"rendering":return(0,B.default)(Nt,{app:this,recording:this.state.recording,renderOptions:this.state.renderOptions})}}async startRecording(){try{let r=await navigator.mediaDevices.getDisplayMedia({video:{width:9999,height:9999}});this.state={name:"recording",captureStream:r},B.default.redraw.sync()}catch(r){console.error(r);return}}stopRecording(r){this.state={name:"previewing",recording:r}}startRendering(r){It(this.state.name,"previewing"),this.state={name:"rendering",recording:this.state.recording,renderOptions:r}}finishRendering(r){It(this.state.name,"rendering"),this.state={name:"playing",gif:r,recording:this.state.recording,renderOptions:this.state.renderOptions}}cancelRendering(){It(this.state.name,"rendering"),this.state={name:"previewing",recording:this.state.recording,renderOptions:this.state.renderOptions}}editGif(){It(this.state.name,"playing"),this.state={name:"previewing",recording:this.state.recording,renderOptions:this.state.renderOptions}}discardGif(){!window.confirm("This will discard the current recording, are you sure you want to continue?")||(this.state={name:"start"})}};function Kr(){B.default.mount(document.getElementById("app-container"),nr)}Kr();})();
//# sourceMappingURL=main.js.map
